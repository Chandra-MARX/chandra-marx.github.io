<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Powerlaw spectrum of an off-axis source &#8212; MARX 5.5.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/marxwebtheme.css?v=c47e7066" />
    
    <script src="../../_static/documentation_options.js?v=947d29b4"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MARX 5.5.3 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Two thermal components on ACIS-I" href="SpectrumAPECACISI.html" />
    <link rel="prev" title="Absorbed powerlaw on ACIS-S" href="SpectrumAbsPowACISS.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../std-parindex.html" title="MARX Parameter Index"
             >MARX Parameters</a> |</li>
        <li class="right" >
          <a href="SpectrumAPECACISI.html" title="Two thermal components on ACIS-I"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="SpectrumAbsPowACISS.html" title="Absorbed powerlaw on ACIS-S"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MARX 5.5.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><strong>marx</strong> accuracy and testing</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../listofcode.html" accesskey="U">List of code used to run tests</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Powerlaw spectrum of an off-axis source</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following shows the code used to run this <strong>marx</strong> test. You can inspect
it and adapt it to your needs, but you cannot copy and paste it directly
because it depends on local <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> and other environment variables.
For example, we use a python function to manage the directory structure
for all the images generated by all the tests instead of giving the file
name directly to save images.</p>
</div>
<section id="powerlaw-spectrum-of-an-off-axis-source">
<span id="test-code-spectrumabspowaciss-offaxis"></span><h1>Powerlaw spectrum of an off-axis source<a class="headerlink" href="#powerlaw-spectrum-of-an-off-axis-source" title="Link to this heading">¶</a></h1>
<section id="sherpa-generate-input-spectrum">
<h2>Sherpa : Generate input spectrum<a class="headerlink" href="#sherpa-generate-input-spectrum" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># set source properties</span>
<span class="n">set_source</span><span class="p">(</span><span class="n">xsphabs</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">xspowerlaw</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">nH</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p</span><span class="o">.</span><span class="n">PhoIndex</span> <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">p</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="c1"># get source</span>
<span class="n">my_src</span> <span class="o">=</span> <span class="n">get_source</span><span class="p">()</span>

<span class="c1"># set energy grid</span>
<span class="n">bin_width</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="n">bin_width</span><span class="p">)</span>

<span class="c1"># evaluate source on energy grid</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">my_src</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>

<span class="n">save_arrays</span><span class="p">(</span><span class="s2">&quot;marx_input.tbl&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">energies</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">flux</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">bin_width</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;keV&quot;</span><span class="p">,</span><span class="s2">&quot;photons/s/cm**2/keV&quot;</span><span class="p">],</span> <span class="n">ascii</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="marx-point-source">
<h2>marx : Point source<a class="headerlink" href="#marx-point-source" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>marx<span class="w"> </span><span class="nv">SourceFlux</span><span class="o">=</span>-1<span class="w"> </span><span class="nv">SpectrumType</span><span class="o">=</span>FILE<span class="w"> </span><span class="nv">SpectrumFile</span><span class="o">=</span>marx_input.tbl<span class="w"> </span><span class="nv">ExposureTime</span><span class="o">=</span><span class="m">30000</span><span class="w"> </span><span class="nv">TStart</span><span class="o">=</span><span class="m">2015</span>.5<span class="w"> </span><span class="nv">OutputDir</span><span class="o">=</span>marx<span class="w"> </span><span class="nv">GratingType</span><span class="o">=</span>NONE<span class="w"> </span><span class="nv">DetectorType</span><span class="o">=</span>ACIS-I<span class="w"> </span><span class="nv">DitherModel</span><span class="o">=</span>INTERNAL<span class="w"> </span><span class="nv">RA_Nom</span><span class="o">=</span><span class="m">30</span><span class="w"> </span><span class="nv">Dec_Nom</span><span class="o">=</span><span class="m">40</span><span class="w"> </span><span class="nv">SourceRA</span><span class="o">=</span><span class="m">29</span>.9814917<span class="w"> </span><span class="nv">SourceDEC</span><span class="o">=</span><span class="m">40</span>.1508083
</pre></div>
</div>
</section>
<section id="marx2fits-turn-into-fits-file">
<h2>marx2fits : turn into fits file<a class="headerlink" href="#marx2fits-turn-into-fits-file" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>marx2fits<span class="w"> </span>--pixadj<span class="o">=</span>NONE<span class="w"> </span>marx<span class="w"> </span>marx_evt2.fits
</pre></div>
</div>
</section>
<section id="marxasp-make-asol-file-for-ciao">
<h2>marxasp : Make asol file for CIAO<a class="headerlink" href="#marxasp-make-asol-file-for-ciao" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>marxasp<span class="w"> </span><span class="nv">MarxDir</span><span class="o">=</span>marx<span class="w"> </span><span class="nv">OutputFile</span><span class="o">=</span>marx_asol1.fits
</pre></div>
</div>
</section>
<section id="ciao-extract-spectra">
<h2>CIAO : Extract spectra<a class="headerlink" href="#ciao-extract-spectra" title="Link to this heading">¶</a></h2>
<p>Use special settings to account for steps that <strong>marx</strong> does not include:
ACIS QE maps and current (non FEF) rmfs.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">phagrid</span><span class="o">=</span><span class="s2">&quot;pi=1:1024:1&quot;</span>

<span class="nv">evtfile</span><span class="o">=</span><span class="s2">&quot;marx_evt2.fits&quot;</span>
<span class="nv">asolfile</span><span class="o">=</span><span class="s2">&quot;marx_asol1.fits&quot;</span>
<span class="nv">phafile</span><span class="o">=</span><span class="s2">&quot;marx_pha.fits&quot;</span>
<span class="nv">rmffile</span><span class="o">=</span><span class="s2">&quot;marx_rmf.fits&quot;</span>
<span class="nv">arffile</span><span class="o">=</span><span class="s2">&quot;marx_arf.fits&quot;</span>
<span class="nv">asphistfile</span><span class="o">=</span><span class="s2">&quot;marx_asp.fits&quot;</span>

asphist<span class="w"> </span><span class="nv">infile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$asolfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">outfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$asphistfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">evtfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$evtfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">clobber</span><span class="o">=</span>yes

dmextract<span class="w"> </span><span class="nv">infile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$evtfile</span><span class="s2">[sky=circle(4200,5200,200)][bin </span><span class="nv">$phagrid</span><span class="s2">]&quot;</span><span class="w"> </span><span class="nv">outfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$phafile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">clobber</span><span class="o">=</span>yes

dmcoords<span class="w"> </span><span class="nv">$evtfile</span><span class="w"> </span><span class="nv">asol</span><span class="o">=</span><span class="nv">$asolfile</span><span class="w"> </span><span class="nv">option</span><span class="o">=</span>sky<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">4200</span><span class="w"> </span><span class="nv">y</span><span class="o">=</span><span class="m">5200</span>
<span class="nv">ccdid</span><span class="o">=</span><span class="k">$(</span>pget<span class="w"> </span>dmcoords<span class="w"> </span>chip_id<span class="k">)</span>
<span class="nv">chipx</span><span class="o">=</span><span class="k">$(</span>pget<span class="w"> </span>dmcoords<span class="w"> </span>chipx<span class="k">)</span>
<span class="nv">chipy</span><span class="o">=</span><span class="k">$(</span>pget<span class="w"> </span>dmcoords<span class="w"> </span>chipy<span class="k">)</span>

<span class="nv">detname</span><span class="o">=</span><span class="s2">&quot;ACIS-</span><span class="nv">$ccdid</span><span class="s2">;UNIFORM;bpmask=0&quot;</span>
<span class="nv">grating</span><span class="o">=</span><span class="s2">&quot;NONE&quot;</span>
<span class="c1"># For ACIS-I, use engrid=&quot;0.3:11.0:0.003&quot;. This reflects a limitation of mkrmf.</span>
<span class="nv">engrid</span><span class="o">=</span><span class="s2">&quot;0.3:12.0:0.003&quot;</span>

mkarf<span class="w"> </span><span class="nv">mirror</span><span class="o">=</span><span class="s2">&quot;hrma&quot;</span><span class="w"> </span><span class="nv">detsubsys</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$detname</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">grating</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$grating</span><span class="s2">&quot;</span><span class="w">         </span><span class="nv">outfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$arffile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">obsfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$evtfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">engrid</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$engrid</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">asphistfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$asphistfile</span><span class="s2">&quot;</span><span class="w">         </span><span class="nv">sourcepixelx</span><span class="o">=</span><span class="m">4200</span><span class="w"> </span><span class="nv">sourcepixely</span><span class="o">=</span><span class="m">5200</span><span class="w"> </span><span class="nv">maskfile</span><span class="o">=</span>NONE<span class="w"> </span><span class="nv">pbkfile</span><span class="o">=</span>NONE<span class="w"> </span><span class="nv">dafile</span><span class="o">=</span>NONE<span class="w"> </span><span class="nv">clobber</span><span class="o">=</span>yes<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span><span class="m">0</span>

<span class="nv">fef</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CALDB</span><span class="s2">/data/chandra/acis/fef_pha/acisD2000-01-29fef_phaN0005.fits&quot;</span>

<span class="nv">cxfilter</span><span class="o">=</span><span class="s2">&quot;chipx_hi&gt;=</span><span class="nv">$chipx</span><span class="s2">,chipx_lo&lt;=</span><span class="nv">$chipx</span><span class="s2">&quot;</span>
<span class="nv">cyfilter</span><span class="o">=</span><span class="s2">&quot;chipy_hi&gt;=</span><span class="nv">$chipy</span><span class="s2">,chipy_lo&lt;=</span><span class="nv">$chipy</span><span class="s2">&quot;</span>
mkrmf<span class="w"> </span><span class="nv">infile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$fef</span><span class="s2">[ccd_id=</span><span class="nv">$ccdid</span><span class="s2">,</span><span class="nv">$cxfilter</span><span class="s2">,</span><span class="nv">$cyfilter</span><span class="s2">]&quot;</span><span class="w"> </span><span class="nv">outfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$rmffile</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">axis1</span><span class="o">=</span><span class="s2">&quot;energy=</span><span class="nv">$engrid</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">axis2</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$phagrid</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">thresh</span><span class="o">=</span>1e-8<span class="w"> </span><span class="nv">clobber</span><span class="o">=</span>yes<span class="w"> </span><span class="nv">verbose</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="ciao-use-default-ciao-tools-to-extract-a-spectrum">
<h2>CIAO : Use default CIAO tools to extract a spectrum<a class="headerlink" href="#ciao-use-default-ciao-tools-to-extract-a-spectrum" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>specextract<span class="w"> </span><span class="s2">&quot;marx_evt2.fits[sky=circle(4200,5200,200)]&quot;</span><span class="w"> </span>spec<span class="w"> </span><span class="nv">asp</span><span class="o">=</span>marx_asp.fits<span class="w"> </span><span class="nv">weight</span><span class="o">=</span>no<span class="w"> </span><span class="nv">clobber</span><span class="o">=</span>yes<span class="w"> </span><span class="nv">mskfile</span><span class="o">=</span>NONE<span class="w"> </span><span class="nv">badpixfile</span><span class="o">=</span>NONE
</pre></div>
</div>
</section>
<section id="sherpa-compare-spectra-to-input-model">
<h2>Sherpa : Compare spectra to input model<a class="headerlink" href="#sherpa-compare-spectra-to-input-model" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load_pha</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;marx_pha.fits&#39;</span><span class="p">)</span>
<span class="n">load_rmf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;marx_rmf.fits&#39;</span><span class="p">)</span>
<span class="n">load_arf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;marx_arf.fits&#39;</span><span class="p">)</span>
<span class="n">load_data</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;spec_grp.pi&#39;</span><span class="p">)</span>
<span class="n">group_counts</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">group_counts</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">ignore</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">ignore</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="c1"># set source properties</span>
<span class="n">set_source</span><span class="p">(</span><span class="n">xsphabs</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">xspowerlaw</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">nH</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p</span><span class="o">.</span><span class="n">PhoIndex</span> <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">p</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">set_source</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Check how good the input parameters work</span>
<span class="n">statres</span> <span class="o">=</span> <span class="n">get_stat_info</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;chi2marx&#39;</span><span class="p">:</span> <span class="n">statres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstat</span><span class="p">,</span>
        <span class="s1">&#39;chi2default&#39;</span><span class="p">:</span> <span class="n">statres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstat</span><span class="p">}</span>

<span class="c1"># Make the plots</span>
<span class="n">plot_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plot_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">conf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">get_conf_results</span><span class="p">()</span>
<span class="n">plot_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_data</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yerrorbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">fit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">conf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">get_conf_results</span><span class="p">()</span>
<span class="n">plot_model</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/melkor/d1/guenther/marx/doc/source/tests/figures/SpectrumAbsPowACISS_offaxis_spec.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="n">plot_arf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plot_arf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/melkor/d1/guenther/marx/doc/source/tests/figures/SpectrumAbsPowACISS_offaxis_arf.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1"># compile conf outputs for saving</span>
<span class="n">out</span><span class="p">[</span><span class="s1">&#39;fitmarx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parnames&#39;</span><span class="p">:</span> <span class="n">c1</span><span class="o">.</span><span class="n">parnames</span><span class="p">,</span>
                   <span class="s1">&#39;parmins&#39;</span><span class="p">:</span> <span class="n">c1</span><span class="o">.</span><span class="n">parmins</span><span class="p">,</span>
                   <span class="s1">&#39;parvals&#39;</span><span class="p">:</span> <span class="n">c1</span><span class="o">.</span><span class="n">parvals</span><span class="p">,</span>
                   <span class="s1">&#39;parmaxes&#39;</span><span class="p">:</span> <span class="n">c1</span><span class="o">.</span><span class="n">parmaxes</span><span class="p">}</span>
<span class="n">out</span><span class="p">[</span><span class="s1">&#39;fitdefault&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parnames&#39;</span><span class="p">:</span> <span class="n">c2</span><span class="o">.</span><span class="n">parnames</span><span class="p">,</span>
                      <span class="s1">&#39;parmins&#39;</span><span class="p">:</span> <span class="n">c2</span><span class="o">.</span><span class="n">parmins</span><span class="p">,</span>
                      <span class="s1">&#39;parvals&#39;</span><span class="p">:</span> <span class="n">c2</span><span class="o">.</span><span class="n">parvals</span><span class="p">,</span>
                      <span class="s1">&#39;parmaxes&#39;</span><span class="p">:</span> <span class="n">c2</span><span class="o">.</span><span class="n">parmaxes</span><span class="p">}</span>

<span class="c1"># Calculate maximum relative difference in arf</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">get_arf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">get_arf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># bring on same energy grid</span>
<span class="n">engrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">engrid</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">energ_lo</span> <span class="o">+</span> <span class="n">a1</span><span class="o">.</span><span class="n">energ_hi</span><span class="p">),</span> <span class="n">a1</span><span class="o">.</span><span class="n">get_y</span><span class="p">())</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">engrid</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">energ_lo</span> <span class="o">+</span> <span class="n">a2</span><span class="o">.</span><span class="n">energ_hi</span><span class="p">)</span> <span class="p">,</span> <span class="n">a2</span><span class="o">.</span><span class="n">get_y</span><span class="p">())</span>

<span class="n">out</span><span class="p">[</span><span class="s1">&#39;arfdiff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a2</span><span class="o">/</span><span class="n">a1</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># write numbers to file for later</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sherpaout.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="python-compare-input-with-fit-model">
<h2>Python : Compare input with fit model<a class="headerlink" href="#python-compare-input-with-fit-model" title="Link to this heading">¶</a></h2>
<p>The input model has several parameters. The calculation here summarizes
all that into a single number: The mean deviation between input and fit
result as measured in terms of Gaussian sigmas.
That is a massive simplification since, the distribution is typically
not Gaussian shaped and parameters might not be independent (e.g. there
is ambiguity between the absorbing column density and the amount of
cool plasma).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that this code might not run if you directly copy and paste it:</span>
<span class="c1"># - Not all import statements are shown here</span>
<span class="c1"># - `self` is a reference to a test instance, which allows access to</span>
<span class="c1">#   parameters such as the directory where the test is run etc.</span>

<span class="sd">&#39;&#39;&#39;Compare input with fit model</span>

<span class="sd">The input model has several parameters. The calculation here summarizes</span>
<span class="sd">all that into a single number: The mean deviation between input and fit</span>
<span class="sd">result as measured in terms of Gaussian sigmas.</span>
<span class="sd">That is a massive simplification since, the distribution is typically</span>
<span class="sd">not Gaussian shaped and parameters might not be independent (e.g. there</span>
<span class="sd">is ambiguity between the absorbing column density and the amount of</span>
<span class="sd">cool plasma).</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">,</span> <span class="s1">&#39;sherpaout.json&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">sherpaout</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="bp">self</span><span class="o">.</span><span class="n">save_test_result</span><span class="p">(</span><span class="s1">&#39;chi2marx&#39;</span><span class="p">,</span> <span class="n">sherpaout</span><span class="p">[</span><span class="s1">&#39;chi2marx&#39;</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">save_test_result</span><span class="p">(</span><span class="s1">&#39;chi2default&#39;</span><span class="p">,</span> <span class="n">sherpaout</span><span class="p">[</span><span class="s1">&#39;chi2default&#39;</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">save_test_result</span><span class="p">(</span><span class="s1">&#39;arfdiff&#39;</span><span class="p">,</span> <span class="n">sherpaout</span><span class="p">[</span><span class="s1">&#39;arfdiff&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<form action="../../search.html" method="get">
<input type="text" name="q" placeholder="Search" />
<input type="hidden" name="check_keywords" value="yes" />
<input type="hidden" name="area" value="default" />
</form>
  <h3><a href="../../index.html">Page Content</a></h3>
  <ul>
<li><a class="reference internal" href="#">Powerlaw spectrum of an off-axis source</a><ul>
<li><a class="reference internal" href="#sherpa-generate-input-spectrum">Sherpa : Generate input spectrum</a></li>
<li><a class="reference internal" href="#marx-point-source">marx : Point source</a></li>
<li><a class="reference internal" href="#marx2fits-turn-into-fits-file">marx2fits : turn into fits file</a></li>
<li><a class="reference internal" href="#marxasp-make-asol-file-for-ciao">marxasp : Make asol file for CIAO</a></li>
<li><a class="reference internal" href="#ciao-extract-spectra">CIAO : Extract spectra</a></li>
<li><a class="reference internal" href="#ciao-use-default-ciao-tools-to-extract-a-spectrum">CIAO : Use default CIAO tools to extract a spectrum</a></li>
<li><a class="reference internal" href="#sherpa-compare-spectra-to-input-model">Sherpa : Compare spectra to input model</a></li>
<li><a class="reference internal" href="#python-compare-input-with-fit-model">Python : Compare input with fit model</a></li>
</ul>
</li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="SpectrumAbsPowACISS.html"
                          title="previous chapter">Absorbed powerlaw on ACIS-S</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="SpectrumAPECACISI.html"
                          title="next chapter">Two thermal components on ACIS-I</a></p>
  </div><hr style="color: #FFF;"></hr>
<a href="http://cxc.harvard.edu/">
    <img src="../../_static/cxcfooterCXCicon.png" 
	 alt="Chandra X-ray Center" class="img-logo"></img>
</a>
<p></p>
<a href="http://space.mit.edu/cxc/">CXC@MIT</a>
<p></p>
<a href="http://space.mit.edu/">
    <img src="../../_static/logo-mit-kavli.png" 
	 alt="MIT Kavli Institute" class="img-logo"></img>
</a>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../std-parindex.html" title="MARX Parameter Index"
             >MARX Parameters</a> |</li>
        <li class="right" >
          <a href="SpectrumAPECACISI.html" title="Two thermal components on ACIS-I"
             >next</a> |</li>
        <li class="right" >
          <a href="SpectrumAbsPowACISS.html" title="Absorbed powerlaw on ACIS-S"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MARX 5.5.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><strong>marx</strong> accuracy and testing</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../listofcode.html" >List of code used to run tests</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Powerlaw spectrum of an off-axis source</a></li> 
      </ul>
    </div>
    <div class="footer">
    <a href="mailto:marx-help@space.mit.edu">MARX support: marx-help@space.mit.edu</a>
    <a href="https://accessibility.mit.edu/">Accessibility</a>
        &copy; Copyright 2002-2023, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>